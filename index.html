<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrigadAAP - Capacitaci√≥n Brigadistas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --verde: #00abaa;
            --coral: #e94662;
            --gris: #484d52;
            --gris-claro: #f0f2f5;
            --blanco: #ffffff;
            --amarillo: #facc15; /* Tailwind yellow-400 */
            --azul: #3b82f6; /* Tailwind blue-500 */
            --naranja: #f97316; /* Tailwind orange-500 */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--gris-claro);
            color: var(--gris);
        }

        .bg-verde-theme { background-color: var(--verde); }
        .bg-coral-theme { background-color: var(--coral); }
        .bg-gris-theme { background-color: var(--gris); }
        .bg-azul-theme { background-color: var(--azul); }
        .bg-naranja-theme { background-color: var(--naranja); }
        .bg-amarillo-theme { background-color: var(--amarillo); }

        .text-verde-theme { color: var(--verde); }
        .text-coral-theme { color: var(--coral); }
        .text-azul-theme { color: var(--azul); }
        .text-naranja-theme { color: var(--naranja); }
        
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
        }

        .progress-bar-bg {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 9999px;
            overflow: hidden;
        }

        .progress-bar-fg {
            height: 100%;
            background-color: var(--blanco);
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
        }
        
        #quiz-screen {
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            transition: opacity 0.3s ease-in-out;
        }

        .answer-option {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .answer-option:hover {
            border-color: var(--verde);
            transform: scale(1.03);
        }
        
        .badge-item {
            transition: all 0.3s ease;
            filter: grayscale(100%);
            opacity: 0.6;
            border-bottom: 4px solid #d1d5db; /* gray-300 */
        }
        
        .badge-item.achieved {
            filter: grayscale(0%);
            opacity: 1;
            border-bottom-color: var(--amarillo);
            transform: scale(1.05);
        }
        .badge-item.achieved .badge-icon {
             transform: scale(1.2);
        }
        
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .fade-out { animation: fadeOut 0.5s ease-in-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        #home-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            transition: transform 0.2s ease;
        }
        #home-button:hover {
            transform: scale(1.1);
        }

    </style>
</head>
<body class="min-h-screen">

    <!-- Pantalla Principal -->
    <div id="main-screen">
        <header class="bg-white shadow-md p-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <img src="https://storage.googleapis.com/gemini-prod-us-west1-assets/1f94851259e8f49491a617a26860d5b4" alt="Logo Cl√≠nica del Prado" class="h-16 w-16 object-contain">
                <h1 class="text-2xl md:text-3xl font-bold text-verde-theme">BrigadAAP</h1>
            </div>
            <div id="user-stats" class="text-right">
                <div id="badge-display" class="flex items-center gap-2 font-semibold bg-verde-theme text-white px-4 py-2 rounded-full">
                    <span id="badge-icon"></span>
                    <span id="badge-name">Principiante</span>
                </div>
                <div class="text-sm text-gris mt-1">Puntos: <span id="score-display">0</span></div>
            </div>
        </header>

        <main class="p-4 md:p-8">
            <h2 class="text-xl md:text-2xl font-bold text-center mb-6 text-gris">M√≥dulos de Aprendizaje</h2>
            <div id="modules-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                <!-- Las tarjetas de los m√≥dulos se insertar√°n aqu√≠ -->
            </div>

            <div class="mt-12">
                 <h2 class="text-xl md:text-2xl font-bold text-center mb-6 text-gris">Tu Camino del H√©roe</h2>
                 <div id="badge-system-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4 md:gap-6 text-center">
                     <!-- Las insignias se insertar√°n aqu√≠ -->
                 </div>
            </div>
        </main>
        
        <footer class="text-center p-4 mt-8 text-gray-500 text-sm">
            &copy; 2025 BrigadAAP - Desarrollado para la Brigada de Emergencias de la Cl√≠nica del Prado.
        </footer>
    </div>

    <!-- Pantalla del Cuestionario -->
    <div id="quiz-screen" class="fixed inset-0 z-50 flex-col justify-center items-center p-4 hidden">
        <div id="quiz-box" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-6 md:p-8 relative fade-in">
            <!-- Vista de Aprendizaje -->
            <div id="learning-view">
                <div class="text-center mb-4">
                    <span class="text-white px-4 py-1 rounded-full font-semibold" id="learning-tag">¬°Aprende!</span>
                </div>
                <p id="learning-text" class="text-lg text-center font-semibold mb-6 min-h-[120px] flex items-center justify-center"></p>
                <button id="continue-to-question-btn" class="w-full font-bold py-3 px-6 rounded-full transition-transform hover:scale-105">
                    Aceptar y Continuar
                </button>
            </div>
            <!-- Vista de Pregunta -->
            <div id="question-view" class="hidden">
                 <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-sm font-semibold" id="quiz-topic-title"></p>
                        <p class="text-2xl font-bold text-gris" id="question-counter"></p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-lg" id="quiz-score-title">Puntos</p>
                        <p id="quiz-score" class="text-2xl font-bold text-gris">0</p>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                    <div id="question-progress" class="h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                
                <p id="question-text" class="text-lg md:text-xl font-semibold mb-6 min-h-[80px]"></p>
                
                <div id="answer-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div id="feedback-message" class="mt-6 text-center font-bold text-lg"></div>
            </div>
        </div>
    </div>
    
    <!-- Bot√≥n de Inicio -->
    <button id="home-button" class="bg-coral-theme text-white p-4 rounded-full shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
    </button>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const questionDB = {
                fire_prevention: {
                    title: 'Prevenci√≥n de Incendios', colorClass: 'bg-naranja-theme', textColorClass: 'text-naranja-theme',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>`,
                    questions: [
                        { l: "El 'Tri√°ngulo del Fuego' representa los tres elementos necesarios para que exista fuego: Combustible, Ox√≠geno y Calor.", q: "¬øCu√°les son los tres componentes del Tri√°ngulo del Fuego?", o: ["Madera, Pl√°stico, Metal", "Agua, Espuma, Polvo", "Calor, Combustible, Ox√≠geno", "Ignici√≥n, Propagaci√≥n, Extinci√≥n"], a: 2 },
                        { l: "El m√©todo de extinci√≥n por enfriamiento consiste en reducir la temperatura del combustible, usualmente aplicando agua.", q: "Aplicar agua a un fuego de madera es un ejemplo del m√©todo de extinci√≥n por:", o: ["Sofocaci√≥n (eliminar ox√≠geno)", "Enfriamiento (eliminar calor)", "Eliminaci√≥n del combustible", "Inhibici√≥n de la reacci√≥n"], a: 1 },
                        { l: "La sobrecarga de enchufes y extensiones el√©ctricas es una de las principales causas de incendios.", q: "¬øCu√°l es una pr√°ctica de prevenci√≥n de incendios el√©ctricos fundamental?", o: ["Usar cables debajo de las alfombras", "Sobrecargar las tomas m√∫ltiples", "Reemplazar fusibles por unos de mayor amperaje", "No sobrecargar enchufes ni extensiones"], a: 3 },
                        { l: "Los l√≠quidos inflamables deben almacenarse en gabinetes de seguridad aprobados, lejos de fuentes de calor.", q: "¬øC√≥mo se deben almacenar correctamente los l√≠quidos inflamables?", o: ["En cualquier estante", "En gabinetes de seguridad, lejos del calor", "Debajo del lavaplatos", "Al aire libre"], a: 1 },
                        { l: "Las rutas de evacuaci√≥n deben estar siempre despejadas, bien se√±alizadas y libres de cualquier tipo de obstrucci√≥n.", q: "Para garantizar una evacuaci√≥n segura, las rutas de escape deben estar:", o: ["Bien iluminadas pero pueden tener cajas", "Libres de obstrucciones y se√±alizadas", "Cerradas con llave por seguridad", "Disponibles solo para gerentes"], a: 1 },
                        { l: "El m√©todo de sofocaci√≥n consiste en eliminar o reducir el ox√≠geno disponible para el fuego, por ejemplo, cubriendo una sart√©n en llamas con una tapa.", q: "Cubrir una sart√©n en llamas con una tapa es un m√©todo de extinci√≥n llamado:", o: ["Enfriamiento", "Inhibici√≥n", "Eliminaci√≥n del combustible", "Sofocaci√≥n"], a: 3 },
                        { l: "El orden y la limpieza son fundamentales en la prevenci√≥n, ya que evitan la acumulaci√≥n de material combustible.", q: "¬øPor qu√© mantener el orden y la limpieza es una medida clave de prevenci√≥n?", o: ["Porque se ve m√°s profesional", "Porque reduce la cantidad de material combustible", "Porque ayuda a encontrar los extintores", "Porque cumple una norma"], a: 1 },
                        { l: "Los detectores de humo deben ser probados mensualmente y sus bater√≠as cambiadas al menos una vez al a√±o.", q: "¬øCu√°l es el mantenimiento m√≠nimo recomendado para un detector de humo?", o: ["Probarlo cada 5 a√±os", "Cambiar la bater√≠a cuando suene", "Probarlo mensualmente y cambiar bater√≠as anualmente", "Limpiarlo con agua"], a: 2 },
                        { l: "En caso de evacuaci√≥n por incendio, nunca se deben usar los ascensores. Siempre use las escaleras.", q: "Durante una evacuaci√≥n por incendio, ¬øpor qu√© nunca debes usar el ascensor?", o: ["Es m√°s lento que las escaleras", "Es solo para los bomberos", "Puede fallar y convertirse en una trampa mortal", "Hace mucho ruido"], a: 2 },
                        { l: "Un 'Punto de Encuentro' es un lugar seguro designado fuera del edificio donde todo el personal debe reunirse para ser contado.", q: "¬øQu√© es un 'Punto de Encuentro' en un plan de evacuaci√≥n?", o: ["El lugar donde se origin√≥ el fuego", "Un √°rea segura designada para reunirse tras evacuar", "La oficina del jefe de la brigada", "La cafeter√≠a"], a: 1 },
                    ]
                },
                extinguishers: {
                    title: 'Manejo de Extintores', colorClass: 'bg-azul-theme', textColorClass: 'text-azul-theme',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 10.5V6.5C14 4 12.5 2 10.5 2S7 4 7 6.5V10.5"/><path d="M14 10.5H7"/><path d="M9.5 10.5V13.5C9.5 14.5 9 15 8.5 15H8"/><path d="M17 12L19 14"/><path d="M17 18L19 16"/><path d="M5 18H17C17 15 15 14 15 14H6.5C6.5 14 5 15 5 18Z"/><path d="M9.5 18V22"/></svg>`,
                    questions: [
                        { l: "La nemotecnia P.A.S.E. es la gu√≠a para usar un extintor: P-Tire del pasador, A-Apunte a la base del fuego, S-Apriete la palanca, E-Escan√©e o mueva de lado a lado.", q: "¬øQu√© significa la 'A' en la nemotecnia P.A.S.E. para usar un extintor?", o: ["Agitar el extintor", "Apuntar a la base del fuego", "Abrir la v√°lvula", "Apartarse del fuego"], a: 1 },
                        { l: "Los extintores Clase A son para fuegos en materiales combustibles comunes como madera, papel o tela.", q: "¬øPara qu√© tipo de fuego se utiliza un extintor Clase A?", o: ["L√≠quidos inflamables", "Equipos el√©ctricos", "Metales combustibles", "Madera, papel y tela"], a: 3 },
                        { l: "Los extintores de Di√≥xido de Carbono (CO2) son ideales para fuegos el√©ctricos porque no conducen la electricidad y no dejan residuos.", q: "¬øCu√°l es la principal ventaja de un extintor de CO2 en equipos electr√≥nicos?", o: ["Es el m√°s barato", "No conduce la electricidad y no deja residuos", "Puede usarse en cualquier tipo de fuego", "Tiene mayor alcance"], a: 1 },
                        { l: "Nunca se debe usar un extintor de agua en un fuego el√©ctrico. El agua es un excelente conductor y podr√≠a electrocutar al operador.", q: "¬øPor qu√© es extremadamente peligroso usar un extintor de agua en un fuego el√©ctrico?", o: ["Porque apaga el fuego muy r√°pido", "Porque el agua conduce la electricidad", "Porque da√±a el equipo", "Porque el agua se evapora"], a: 1 },
                        { l: "La distancia de ataque efectiva para la mayor√≠a de los extintores port√°tiles es de 1 a 3 metros.", q: "¬øCu√°l es la distancia segura y efectiva para atacar un fuego con un extintor port√°til?", o: ["Menos de 1 metro", "De 1 a 3 metros", "De 5 a 7 metros", "M√°s de 8 metros"], a: 1 },
                        { l: "Los extintores Clase K est√°n dise√±ados espec√≠ficamente para fuegos en cocinas, involucrando aceites y grasas de cocina.", q: "Un fuego en una freidora industrial de una cocina requiere un extintor de Clase:", o: ["A", "B", "D", "K"], a: 3 },
                        { l: "Siempre se debe atacar un fuego d√°ndole la espalda a una ruta de escape segura para poder retirarte r√°pidamente si es necesario.", q: "Al usar un extintor, tu espalda siempre debe estar orientada hacia:", o: ["La pared m√°s cercana", "El centro del fuego", "Una ruta de escape segura", "Otro compa√±ero"], a: 2 },
                        { l: "Los extintores deben ser inspeccionados mensualmente para asegurar que est√©n cargados (man√≥metro en verde) y sin da√±os.", q: "¬øCon qu√© frecuencia se debe realizar una inspecci√≥n visual a un extintor?", o: ["Diariamente", "Semanalmente", "Mensualmente", "Anualmente"], a: 2 },
                        { l: "El Polvo Qu√≠mico Seco (PQS) es un agente extintor vers√°til, efectivo para fuegos de clase A, B y C.", q: "Un extintor de PQS (Polvo Qu√≠mico Seco) es com√∫nmente clasificado como:", o: ["Solo Clase A", "Solo Clase B", "Clase A, B y C", "Solo Clase K"], a: 2 },
                        { l: "Despu√©s de usar un extintor, incluso por un segundo, debe ser reportado para recarga o reemplazo. Nunca se debe colgar un extintor usado.", q: "¬øQu√© se debe hacer con un extintor despu√©s de usarlo, aunque sea un poco?", o: ["Limpiarlo y colgarlo de nuevo", "Dejarlo en el suelo y reportarlo para recarga", "Guardarlo para la pr√≥xima vez", "Verificar si todav√≠a se siente pesado"], a: 1 },
                    ]
                },
                scene_access: {
                    title: 'Acceso a la Escena', colorClass: 'bg-coral-theme', textColorClass: 'text-coral-theme',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path><path d="M12 22a10 10 0 0 0 10-10h-10z"></path><circle cx="12" cy="12" r="3"></circle></svg>`,
                    questions: [
                        { l: "La seguridad del rescatista es lo primero. Un rescatista herido no puede ayudar a nadie.", q: "Al llegar a una escena, ¬øcu√°l es la primera prioridad?", o: ["Correr a ayudar a la v√≠ctima", "Evaluar la seguridad de la escena", "Llamar a los medios", "Buscar testigos"], a: 1 },
                        { l: "La Zona Caliente es el √°rea de m√°xima contaminaci√≥n y riesgo, donde solo entra personal especializado.", q: "La 'Zona Caliente' en un incidente con materiales peligrosos es donde...", o: ["Se realiza la descontaminaci√≥n", "Se atiende a los pacientes", "Est√° el producto y el mayor riesgo", "Se ubica el Puesto de Comando"], a: 2 },
                        { l: "CINECSS es una nemotecnia para recordar los 6 elementos a evaluar para la seguridad de la escena: Control, Incendio, Nubes, Electricidad, Ca√≠das, Sustancias.", q: "Al evaluar la seguridad de la escena, se debe usar la nemotecnia:", o: ["CINECSS", "ABCDEX", "START", "SOAP"], a: 0 },
                        { l: "La 'C' en CINECSS significa 'Control de la escena'. Implica asegurar que el √°rea est√© bajo control.", q: "La 'C' en CINECSS se refiere a:", o: ["Clima", "Comandante", "Control de la escena", "Circulaci√≥n"], a: 2 },
                        { l: "Aislar la escena significa crear un per√≠metro de seguridad para mantener a los curiosos fuera y evitar que la evidencia se contamine.", q: "¬øQu√© significa 'aislar la escena'?", o: ["Apagar todas las luces", "Establecer un per√≠metro para controlar el acceso", "No dejar que nadie salga", "Hablar con todos los presentes"], a: 1 },
                        { l: "La electricidad es un peligro mortal invisible. Asume siempre que los cables ca√≠dos tienen corriente y espera a los expertos.", q: "Si encuentras cables el√©ctricos ca√≠dos en la escena, t√∫ debes:", o: ["Moverlos con un palo de madera", "Asumir que no tienen corriente", "Mantener la distancia y avisar a expertos", "Pasar por encima con cuidado"], a: 2 },
                        { l: "La Zona Tibia es una zona de transici√≥n entre la Zona Caliente y la Fr√≠a, y es donde se realiza la descontaminaci√≥n.", q: "La Zona Tibia es el √°rea para:", o: ["Primeros auxilios b√°sicos", "Descontaminaci√≥n del personal", "Reuniones de planificaci√≥n", "Estacionar veh√≠culos"], a: 1 },
                        { l: "La evaluaci√≥n 360¬∞ consiste en caminar completamente alrededor del incidente para identificar todos los peligros, v√≠ctimas y accesos.", q: "La evaluaci√≥n 360¬∞ de la escena implica:", o: ["Mirar solo hacia el frente", "Girar 360 grados sobre tu eje", "Caminar alrededor del incidente para verlo completo", "Usar binoculares"], a: 2 },
                        { l: "Un accidente vehicular puede tener muchos peligros: tr√°fico, vidrios, derrames y airbags sin desplegar.", q: "¬øCu√°l es un peligro potencial en una escena de trauma vehicular?", o: ["Tr√°fico, vidrios rotos, bolsas de aire sin activar", "M√∫sica alta", "Curiosos", "Lluvia"], a: 0 },
                        { l: "Tu Equipo de Protecci√≥n Personal (EPP) es tu armadura. Es la barrera m√°s importante entre tu seguridad y los peligros de la escena.", q: "El uso de Equipo de Protecci√≥n Personal (EPP) es fundamental para:", o: ["Verse profesional", "Proteger al rescatista de lesiones o enfermedades", "Identificar al l√≠der", "Mantener el calor"], a: 1 },
                    ]
                },
                sci: {
                    title: 'Sistema Comando de Incidentes', colorClass: 'bg-verde-theme', textColorClass: 'text-verde-theme',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="M12 11v0M12 7v0"></path><path d="M12 15v0"></path></svg>`,
                    questions: [
                        { l: "El Comandante del Incidente (CI) es la m√°xima autoridad en la escena y es responsable de la gesti√≥n integral del evento.", q: "¬øCu√°l es la funci√≥n principal del Comandante del Incidente (CI)?", o: ["Evaluar a los pacientes", "Gestionar todas las operaciones del incidente", "Hablar con los medios", "Conseguir recursos"], a: 1 },
                        { l: "La Unidad de Mando asegura que cada persona reciba √≥rdenes de un solo supervisor, evitando confusi√≥n.", q: "El principio de 'Unidad de Mando' significa que cada persona...", o: ["Puede tener varios jefes", "Reporta a un solo supervisor", "Es el jefe de s√≠ mismo", "No necesita supervisi√≥n"], a: 1 },
                        { l: "La secci√≥n de Log√≠stica es el 'supermercado' del incidente. Se encarga de proveer todo lo necesario: personal, equipos y suministros.", q: "¬øQu√© secci√≥n es responsable de conseguir personal, equipos y suministros?", o: ["Planificaci√≥n", "Operaciones", "Log√≠stica", "Finanzas/Administraci√≥n"], a: 2 },
                        { l: "El Oficial de Seguridad monitorea las condiciones y tiene la autoridad para detener cualquier operaci√≥n insegura.", q: "El Oficial de Seguridad es responsable de:", o: ["La seguridad de todo el personal involucrado", "Pagar las cuentas del incidente", "Dirigir las t√°cticas", "Crear el plan del incidente"], a: 0 },
                        { l: "El Plan de Acci√≥n del Incidente (PAI) es el documento que gu√≠a todas las operaciones de respuesta.", q: "¬øQu√© significa el acr√≥nimo P.A.I. en el SCI?", o: ["Plan de Acci√≥n Inmediata", "Protocolo de Ayuda Interna", "Plan de Acci√≥n del Incidente", "Personal de Apoyo Inicial"], a: 2 },
                        { l: "El √Årea de Espera es donde se concentran los recursos que llegan a la escena hasta que se les asigna una tarea.", q: "El √°rea donde se concentran los recursos mientras esperan ser asignados se llama:", o: ["Base", "Campamento", "√Årea de Espera", "Helipunto"], a: 2 },
                        { l: "La estructura del SCI es modular, lo que significa que puede crecer o decrecer seg√∫n la magnitud del evento.", q: "La estructura modular del SCI permite que la organizaci√≥n...", o: ["Sea siempre grande", "Se expanda o contraiga seg√∫n la necesidad", "Tenga una estructura fija", "Solo funcione en desastres"], a: 1 },
                        { l: "El Oficial de Informaci√≥n P√∫blica (PIO) es el √∫nico punto de contacto para los medios, asegurando que la informaci√≥n sea precisa.", q: "El Oficial de Informaci√≥n P√∫blica (PIO) es el contacto principal para:", o: ["Los medios y el p√∫blico", "El personal de la brigada", "El director de la cl√≠nica", "Las aseguradoras"], a: 0 },
                        { l: "El Tramo de Control ideal es de 3 a 7 subordinados por cada l√≠der para mantener una supervisi√≥n efectiva.", q: "¬øCu√°l es el rango √≥ptimo del 'Tramo de Control' en el SCI?", o: ["1 a 2 subordinados", "10 a 15 subordinados", "3 a 7 subordinados", "M√°s de 20 subordinados"], a: 2 },
                        { l: "El Puesto de Comando (PC) es el centro neur√°lgico desde donde se dirige y coordina toda la respuesta.", q: "El establecimiento del Puesto de Comando es una de las primeras prioridades para:", o: ["Tener un lugar para descansar", "Centralizar el mando y control", "Guardar los equipos", "Atender a los heridos"], a: 1 },
                    ]
                },
                abcdex: {
                    title: 'Evaluaci√≥n Primaria ABCDEX', colorClass: 'bg-gris-theme', textColorClass: 'text-gris-theme',
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
                    questions: [
                        { l: "La 'A' significa V√≠a A√©rea (Airway). La prioridad es asegurar que est√© abierta y despejada, protegiendo siempre la columna cervical.", q: "¬øQu√© eval√∫a la 'A' en ABCDEX?", o: ["Actitud del paciente", "Apertura de la v√≠a A√©rea y control cervical", "Amigos presentes", "Alergias"], a: 1 },
                        { l: "La 'B' es por Buena Ventilaci√≥n (Breathing). Si el paciente no respira, se debe iniciar la RCP inmediatamente.", q: "Si un paciente no responde y no respira, ¬øqu√© acci√≥n es prioritaria en la 'B'?", o: ["Buscar el pulso", "Iniciar compresiones tor√°cicas", "Dar ventilaciones de rescate", "Ponerlo de lado"], a: 1 },
                        { l: "La 'C' es por Circulaci√≥n. Se busca el pulso y, crucialmente, se controla cualquier sangrado grave que amenace la vida.", q: "La 'C' (Circulaci√≥n) eval√∫a principalmente:", o: ["El color de la piel", "La temperatura corporal", "La presencia de pulso y hemorragias severas", "La conciencia del paciente"], a: 2 },
                        { l: "La 'D' se refiere al D√©ficit Neurol√≥gico. Se eval√∫a el estado de conciencia del paciente para detectar lesiones en la cabeza.", q: "¬øQu√© escala se utiliza com√∫nmente en la 'D' (D√©ficit neurol√≥gico)?", o: ["Escala de Dolor", "Escala de Glasgow", "Escala de Ansiedad", "Escala de Richter"], a: 1 },
                        { l: "La 'E' es por Exposici√≥n. Se debe descubrir al paciente para buscar lesiones ocultas, pero es vital protegerlo del fr√≠o (hipotermia).", q: "La 'E' (Exposici√≥n) implica descubrir al paciente para buscar lesiones, pero es crucial:", o: ["Hacerlo r√°pidamente en p√∫blico", "Cortar toda la ropa siempre", "Prevenir la hipotermia", "Tomar fotograf√≠as"], a: 2 },
                        { l: "Si no hay sospecha de lesi√≥n en el cuello, la maniobra de Frente-Ment√≥n es la forma m√°s r√°pida de abrir la v√≠a a√©rea.", q: "En un paciente inconsciente sin trauma cervical, la maniobra para abrir la v√≠a a√©rea es:", o: ["Frente-ment√≥n", "Tracci√≥n mandibular", "Meter los dedos", "Soplarle en la cara"], a: 0 },
                        { l: "El relleno capilar mide la perfusi√≥n de los tejidos. M√°s de 2 segundos en volver a su color normal indica posibles problemas de circulaci√≥n.", q: "¬øQu√© es el 'Relleno Capilar' evaluado en la 'C'?", o: ["El tiempo que tarda la piel en volver a su color", "La cantidad de sangre perdida", "El nivel de ox√≠geno", "La presi√≥n arterial"], a: 0 },
                        { l: "La escala AVDI clasifica la conciencia: A-Alerta, V-Voz, D-Dolor, I-Inconsciente. Es una evaluaci√≥n neurol√≥gica r√°pida.", q: "Un paciente que responde solo a est√≠mulos dolorosos se clasifica en la escala AVDI como:", o: ["A (Alerta)", "V (Verbal)", "D (Dolor)", "I (Inconsciente)"], a: 2 },
                        { l: "Detener un sangrado que brota a chorros es la principal causa de muerte prevenible en trauma y es una prioridad en la 'C'.", q: "El control de una hemorragia externa masiva es una prioridad en la letra:", o: ["A", "B", "C", "D"], a: 2 },
                        { l: "El formato XABCDE a√±ade la 'X' para priorizar el control de 'Hemorragias Exanguinantes' antes que cualquier otra cosa.", q: "La 'X' en algunas gu√≠as (XABCDE) se ha a√±adido para priorizar:", o: ["Radiograf√≠as (X-Rays)", "El control de hemorragias exanguinantes", "Ox√≠geno (Oxygen)", "Nada, es un error"], a: 1 },
                    ]
                }
            };

            const badges = [
                { name: 'Principiante', score: 0, icon: 'üéì' },
                { name: 'Brigadista', score: 100, icon: '‚õëÔ∏è' },
                { name: 'Rescatista', score: 250, icon: 'üë©‚Äçüöí' },
                { name: 'Experto', score: 500, icon: 'üåü' },
                { name: 'Maestro', score: 750, icon: 'üèÜ' },
                { name: 'Campe√≥n', score: 1000, icon: 'üëë' }
            ];

            let state = { score: 0, currentTopicId: null, currentQuestionIndex: 0, quizScore: 0, topics: {} };
            
            const mainScreen = document.getElementById('main-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const modulesContainer = document.getElementById('modules-container');
            const badgeSystemContainer = document.getElementById('badge-system-container');
            const scoreDisplay = document.getElementById('score-display');
            const badgeName = document.getElementById('badge-name');
            const badgeIcon = document.getElementById('badge-icon');
            const homeButton = document.getElementById('home-button');
            const quizBox = document.getElementById('quiz-box');
            
            const learningView = document.getElementById('learning-view');
            const questionView = document.getElementById('question-view');
            const learningText = document.getElementById('learning-text');
            const learningTag = document.getElementById('learning-tag');
            const continueToQuestionBtn = document.getElementById('continue-to-question-btn');

            const quizTopicTitle = document.getElementById('quiz-topic-title');
            const questionCounter = document.getElementById('question-counter');
            const questionProgress = document.getElementById('question-progress');
            const questionText = document.getElementById('question-text');
            const answerOptionsContainer = document.getElementById('answer-options');
            const feedbackMessage = document.getElementById('feedback-message');
            const quizScoreDisplay = document.getElementById('quiz-score');
            const quizScoreTitle = document.getElementById('quiz-score-title');

            function saveState() { localStorage.setItem('brigadAAPState', JSON.stringify(state)); }

            function loadState() {
                const savedState = localStorage.getItem('brigadAAPState');
                if (savedState) {
                    state = JSON.parse(savedState);
                } else {
                    // Estado para un usuario nuevo
                    state = {
                        score: 0,
                        topics: {}
                    };
                }

                // Asegura que todos los temas de la BD existan en el estado y est√©n desbloqueados
                Object.keys(questionDB).forEach(key => {
                    if (!state.topics[key]) {
                        state.topics[key] = { progress: 0, completed: false };
                    }
                    state.topics[key].unlocked = true;
                });
            }

            function init() {
                loadState();
                renderAll();
                homeButton.addEventListener('click', goHome);
                continueToQuestionBtn.addEventListener('click', displayQuestion);
            }

            function renderAll() {
                renderModules();
                renderBadgeSystem();
                updateUserStats();
            }

            function renderModules() {
                modulesContainer.innerHTML = '';
                Object.keys(questionDB).forEach(key => {
                    const topic = questionDB[key];
                    const topicState = state.topics[key];
                    const isLocked = !topicState.unlocked; // This will always be false now

                    const card = document.createElement('div');
                    card.className = `card rounded-xl shadow-lg flex flex-col cursor-pointer ${topic.colorClass}`;
                    card.dataset.topicId = key;
                    
                    card.innerHTML = `
                        <div class="card-content p-6 text-white text-center flex flex-col items-center h-full">
                            <div class="mb-4 opacity-80">${topic.icon}</div>
                            <h3 class="text-lg font-bold mb-2 flex-grow">${topic.title}</h3>
                            <div class="w-full progress-bar-bg h-3 my-4">
                                <div class="progress-bar-fg" style="width: ${topicState.progress}%"></div>
                            </div>
                            <p class="text-sm opacity-90 mb-4">Progreso: ${topicState.progress}%</p>
                            <div class="bg-white/20 text-white font-bold py-2 px-6 rounded-full hover:bg-white/30 transition-colors mt-auto">
                                ${topicState.completed ? 'Repasar' : 'Comenzar'}
                            </div>
                        </div>
                    `;

                    card.addEventListener('click', () => startQuiz(key));
                    modulesContainer.appendChild(card);
                });
            }

            function renderBadgeSystem() {
                badgeSystemContainer.innerHTML = '';
                badges.forEach(badge => {
                    const isAchieved = state.score >= badge.score;
                    const badgeEl = document.createElement('div');
                    badgeEl.className = `badge-item bg-white p-4 rounded-lg shadow ${isAchieved ? 'achieved' : ''}`;
                    badgeEl.innerHTML = `
                        <div class="badge-icon text-4xl mb-2 transition-transform">${badge.icon}</div>
                        <div class="font-bold text-sm">${badge.name}</div>
                        <div class="text-xs text-gray-500">${badge.score} Pts</div>
                    `;
                    badgeSystemContainer.appendChild(badgeEl);
                });
            }
            
            function updateUserStats() {
                scoreDisplay.textContent = state.score;
                const currentBadge = badges.slice().reverse().find(b => state.score >= b.score);
                if (currentBadge) {
                    badgeName.textContent = currentBadge.name;
                    badgeIcon.textContent = currentBadge.icon;
                }
            }
            
            function startQuiz(topicId) {
                state.currentTopicId = topicId;
                state.currentQuestionIndex = 0;
                state.quizScore = 0;

                mainScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');
                quizScreen.classList.add('flex');
                quizBox.classList.remove('fade-out');
                quizBox.classList.add('fade-in');
                quizScoreDisplay.textContent = state.quizScore;
                displayLearning();
            }

            function displayLearning() {
                learningView.classList.remove('hidden');
                questionView.classList.add('hidden');
                const topicId = state.currentTopicId;
                const index = state.currentQuestionIndex;
                const questionData = questionDB[topicId].questions[index];
                const topicData = questionDB[topicId];

                learningTag.className = 'text-white px-4 py-1 rounded-full font-semibold';
                learningTag.classList.add(topicData.colorClass);
                
                continueToQuestionBtn.className = 'w-full text-gray-800 font-bold py-3 px-6 rounded-full transition-transform hover:scale-105 bg-amarillo-theme';

                learningText.textContent = questionData.l;
            }

            function displayQuestion() {
                learningView.classList.add('hidden');
                questionView.classList.remove('hidden');
                feedbackMessage.textContent = '';
                answerOptionsContainer.innerHTML = '';
                
                const topicId = state.currentTopicId;
                const index = state.currentQuestionIndex;
                const topicData = questionDB[topicId];
                const questionData = topicData.questions[index];

                [quizTopicTitle, quizScoreTitle].forEach(el => {
                    el.className = el.className.replace(/text-.*-theme/, topicData.textColorClass).replace(/text-.*-theme/, topicData.textColorClass);
                });
                questionProgress.className = 'h-2.5 rounded-full';
                questionProgress.classList.add(topicData.colorClass);
                quizTopicTitle.textContent = topicData.title;
                questionCounter.textContent = `Pregunta ${index + 1} de ${topicData.questions.length}`;
                questionText.textContent = questionData.q;
                
                const progressPercentage = ((index) / topicData.questions.length) * 100;
                questionProgress.style.width = `${progressPercentage}%`;

                questionData.o.forEach((option, i) => {
                    const optionButton = document.createElement('button');
                    optionButton.className = 'answer-option bg-gray-100 p-4 rounded-lg shadow text-left';
                    optionButton.textContent = option;
                    optionButton.dataset.index = i;
                    optionButton.addEventListener('click', selectAnswer);
                    answerOptionsContainer.appendChild(optionButton);
                });
            }

            function selectAnswer(e) {
                const selectedButton = e.currentTarget;
                const selectedIndex = parseInt(selectedButton.dataset.index);
                const topicId = state.currentTopicId;
                const question = questionDB[topicId].questions[state.currentQuestionIndex];
                const isCorrect = selectedIndex === question.a;

                const options = answerOptionsContainer.querySelectorAll('.answer-option');
                options.forEach(btn => btn.disabled = true);
                selectedButton.classList.add('selected');

                if (isCorrect) {
                    state.quizScore += 10;
                    state.score += 10;
                    feedbackMessage.textContent = '¬°Correcto! ¬°+10 Puntos!';
                    feedbackMessage.className = 'mt-6 text-center font-bold text-lg text-verde-theme';
                    selectedButton.classList.add('correct');
                } else {
                    feedbackMessage.textContent = '¬°Incorrecto!';
                    feedbackMessage.className = 'mt-6 text-center font-bold text-lg text-coral-theme';
                    selectedButton.classList.add('incorrect');
                    options[question.a].classList.add('correct');
                }

                quizScoreDisplay.textContent = state.quizScore;
                updateUserStats();
                saveState();

                setTimeout(() => {
                    state.currentQuestionIndex++;
                    if (state.currentQuestionIndex < questionDB[topicId].questions.length) {
                        displayLearning();
                    } else {
                        endQuiz();
                    }
                }, 2000);
            }
            
            function endQuiz() {
                const topicId = state.currentTopicId;
                const questions = questionDB[topicId].questions;
                const correctAnswers = state.quizScore / 10;
                
                if (correctAnswers / questions.length >= 0.7) {
                    state.topics[topicId].progress = 100;
                    state.topics[topicId].completed = true;
                    feedbackMessage.textContent = "¬°Felicidades, completaste el m√≥dulo!";
                } else {
                    state.topics[topicId].progress = Math.round((correctAnswers / questions.length) * 100);
                    feedbackMessage.textContent = "¬°Necesitas practicar m√°s! Int√©ntalo de nuevo.";
                }
                
                saveState();
                setTimeout(goHome, 2500);
            }

            function goHome() {
                quizBox.classList.add('fade-out');
                setTimeout(() => {
                    quizScreen.classList.add('hidden');
                    quizScreen.classList.remove('flex');
                    mainScreen.classList.remove('hidden');
                    renderAll();
                }, 400);
            }

            init();
        });
    </script>
</body>
</html>
